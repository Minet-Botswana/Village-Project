{% extends 'customer/customerbase.html' %}
{% block content %}
{%load static%}
{% load widget_tweaks %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- Add SweetAlert library -->
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <style>
        a:link {
            text-decoration: none;
        }
        .content{
          background-color: #fff;
        }
    /* Style the modal header */
    #policyModal .modal-header {
        background-color: #e21a22;
        color: #fff;
        border-bottom: 1px solid #ddd;
        padding: 15px;
        text-align: center;
        font-size: small;
    }

    /* Style the modal title */
    #policyModal .modal-title {
        font-size: 1.5em;
    }

    /* Style the modal body */
    #policyModal .modal-body {
        padding: 20px;
    }

    /* Style the modal footer */
    #policyModal .modal-footer {
        border-top: 1px solid #ddd;
        padding: 15px;
        text-align: center;
    }

    /* Style the close button */
    #policyModal .close {
        color: #fff;
    }

    /* Style the content inside the modal body */
    #policyDetails p {
        margin-bottom: 10px;
        font-size: 15px; /* Change the font size as needed */
        background-color: #f0f0f0; /* Light gray background color */
        padding: 5px 10px; /* Add padding for better visual appearance */
        color: #000; /* Black font color */
    }

    /* Style the horizontal rule beneath the title */
#policyModal hr {
    border: 0;
    height: 1px;
    background-color: #ccc; /* Color of the line */
    margin: 15px 0; /* Adjust margin as needed */
}
    </style>
</head>

<h1 class="breadcrumb" style="font-size: 18px; font-family: 
'Segoe UI', 'Segoe UI Web (West European)', 'Segoe UI', 
-apple-system, BlinkMacSystemFont, Roboto, 'Helvetica Neue', 
sans-serif; color: #e21a22; margin-top: 42px;"
>
Thirdparty Insurance
</h1>

<p class="breadcrumb" style="margin-top: 20px; font-size: 14px; font-family: 
'Segoe UI', 'Segoe UI Web (West European)', 'Segoe UI', 
-apple-system, BlinkMacSystemFont, Roboto, 'Helvetica Neue', 
sans-serif; color: #e21a22;" >
   Complete our Thirdparty Cover Application Form for a smooth, secure onboarding process. 
   Your confidentiality is a priority at Minet Botswana. Thank you for choosing us, where simplicity meets security..
</p>


<body>

    <!-- Modal -->
    <div class="modal fade" id="policyModal" tabindex="-1" role="dialog" aria-labelledby="policyModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="policyModalLabel">Coverage Overview</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="policyDetails">
                    <!-- Policy details will be automatically & dynamically inserted here -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <!-- Add additional modal buttons if needed -->
                </div>
            </div>
        </div>
    </div>

    <h2 style="text-align:center; color:#e21a22; font-family: Titillium Web, sans-serif; font-size: 20px; background-color: rgb(255, 255, 255);">Add Policy (Third Party Motor Insurance)</h2>
    
    <form method="POST" autocomplete="off" style="margin:100px;margin-top: 0px;" action="{% url 'customer:apply-thirdparty' %}">
        {% csrf_token %}
        
        <!-- Customer Information Section -->
        <div class="panel panel-default" style="margin-bottom: 20px;">
            <div class="panel-heading" style="background-color: #e21a22; color: white;">
                <h4 class="panel-title">Customer Information</h4>
            </div>
            <div class="panel-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="id_number">ID Number</label>
                            <input type="text" name="id_number" id="id_number" class="form-control" placeholder="Enter ID Number" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="category">Cover Category</label>
                            <select name="category" id="category" class="form-control" required>
                                <option value="" selected disabled>Select Cover Category</option>
                                <option value="2" disabled>Long Term Cover</option>
                                <option value="3">Short Term Cover</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Vehicle Information Section -->
        <div class="panel panel-default" style="margin-bottom: 20px;">
            <div class="panel-heading" style="background-color: #e21a22; color: white;">
                <h4 class="panel-title">Vehicle Information</h4>
            </div>
            <div class="panel-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="vehicle_type">Vehicle Type</label>
                            <select name="vehicle_type" id="vehicle_type" class="form-control" required>
                                <option value="">Select Vehicle Type</option>
                                <option value="sedan">Sedan</option>
                                <option value="hatchback">Hatchback</option>
                                <option value="suv">SUV</option>
                                <option value="truck">Truck</option>
                                <option value="van">Van</option>
                                <option value="bus">Bus</option>
                                <option value="motorcycle">Motorcycle</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="vehicle_make">Vehicle Make</label>
                            <input type="text" name="vehicle_make" id="vehicle_make" class="form-control" placeholder="e.g., Toyota, BMW, Ford" required>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="vehicle_model">Vehicle Model</label>
                            <input type="text" name="vehicle_model" id="vehicle_model" class="form-control" placeholder="e.g., Corolla, X5, Focus" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="vehicle_year">Year of Manufacture</label>
                            <input type="number" name="vehicle_year" id="vehicle_year" class="form-control" placeholder="e.g., 2020" min="1900" max="2024" required>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="registration_number">Registration Number</label>
                            <input type="text" name="registration_number" id="registration_number" class="form-control" placeholder="Vehicle registration number" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="chassis_number">Chassis Number</label>
                            <input type="text" name="chassis_number" id="chassis_number" class="form-control" placeholder="Vehicle chassis number" required>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="engine_number">Engine Number</label>
                            <input type="text" name="engine_number" id="engine_number" class="form-control" placeholder="Engine number" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="territorial_limits">Territorial Limits</label>
                            <select name="territorial_limits" id="territorial_limits" class="form-control" required>
                                <option value="">Select Territorial Limits</option>
                                <option value="botswana">Botswana Only</option>
                                <option value="sadc">SADC Countries</option>
                                <option value="africa">Africa</option>
                                <option value="worldwide">Worldwide</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Policy Information Section -->
        <div class="panel panel-default" style="margin-bottom: 20px;">
            <div class="panel-heading" style="background-color: #e21a22; color: white;">
                <h4 class="panel-title">Policy Information</h4>
            </div>
            <div class="panel-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="policy_name">Risk</label>
                            <input type="text" name="policy_name" id="policy_name" class="form-control" placeholder="Risk" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="premium">Premium (BWP)</label>
                            <input type="text" name="premium" id="premium" class="form-control" value="1140.00" required readonly>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="cover_start">Cover Start:</label>
                            <input type="date" name="cover_start" id="cover_start" class="form-control" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="tenure">Tenure (in months):</label>
                            <input type="number" name="tenure" id="id_tenure" class="form-control" placeholder="Tenure (in months)" value="12" readonly required>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="id_expiry_date">Expiry Date:</label>
                            <input type="text" name="expiry_date" class="form-control" id="id_expiry_date" readonly>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="id_cover_end">Renewal Date:</label>
                            <input type="text" name="renewal_date" class="form-control" id="id_cover_end" value="{{ formattedCoverEnd|default:''|date:'Y-m-d' }}" readonly>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#policyModal">
            View Policy
        </button>
        <button type="submit" class="btn btn-primary" style="background-color: #e21a22;">Create Policy</button>
    </form>
    
      <br><br><br><br>
  
      <!-- Include jQuery and Bootstrap JS from CDN -->
      <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
      <script>
        // Function to calculate cover_end based on cover_start and tenure
        function updateCoverEnd() {
            var coverStart = new Date(document.getElementById("id_cover_start").value);
            var tenure = parseInt(document.getElementById("id_tenure").value);
            
            if (!isNaN(tenure) && coverStart instanceof Date && !isNaN(coverStart)) {
                var coverEnd = new Date(coverStart);
                coverEnd.setMonth(coverEnd.getMonth() + tenure);
    
                // Format the date as "YYYY-MM-DD"
                var formattedCoverEnd = coverEnd.toISOString().split('T')[0];
                
                document.getElementById("id_cover_end").value = formattedCoverEnd;
            }
        }
    
        // Attach the function to the change event of the tenure field
        document.getElementById("id_tenure").addEventListener("input", updateCoverEnd);
    </script>
  
  <!--script>
    function calculatePremium() {
        var sumAssurance = parseFloat(document.getElementById('sum_assurance').value);
        if (!isNaN(sumAssurance)) {
            // Assuming 8% premium rate, you can adjust this percentage as needed
            var premiumRate = 0.13;
            var premium = sumAssurance * premiumRate;
            document.getElementById('premium').value = premium.toFixed(2);
        } else {
            document.getElementById('premium').value = '';
        }
    }
  </script-->
  
      <script>
        $(document).ready(function () {
      // When the "View Policy" button is clicked
      $("button[data-target='#policyModal']").click(function () {
          // Log a message to confirm that the button click event is triggered
          console.log("Button clicked!");
  
          // Get the values from the form fields
          var idNumber = $("input[name='id_number']").val();
          var category = $("select[name='category'] option:selected").val();
          var policyName = $("input[name='policy_name']").val();
          var premium = $("input[name='premium']").val();
          var coverStart = $("input[name='cover_start']").val();
          var tenure = $("input[name='tenure']").val();
          
          // Get vehicle information
          var vehicleType = $("select[name='vehicle_type'] option:selected").text();
          var vehicleMake = $("input[name='vehicle_make']").val();
          var vehicleModel = $("input[name='vehicle_model']").val();
          var vehicleYear = $("input[name='vehicle_year']").val();
          var registrationNumber = $("input[name='registration_number']").val();
          var chassisNumber = $("input[name='chassis_number']").val();
          var engineNumber = $("input[name='engine_number']").val();
          var territorialLimits = $("select[name='territorial_limits'] option:selected").text();
          
          // Calculate cover_end based on cover_start and tenure
          var coverEnd = new Date(coverStart);
          coverEnd.setMonth(coverEnd.getMonth() + parseInt(tenure));
  
          // Format the date as "YYYY-MM-DD"
          var formattedCoverEnd = coverEnd.toISOString().split('T')[0];
  
          // Calculate renewal date
          var formattedRenewalDate = formattedCoverEnd;
  
          // Calculate expiry date (one day before renewal date)
          var expiryDate = new Date(coverEnd);
          expiryDate.setDate(expiryDate.getDate() - 1);
          var formattedExpiryDate = expiryDate.toISOString().split('T')[0];
  
          // Check if any of the required values are empty or null
          if (!idNumber || !category || !policyName || !premium || !coverStart || !tenure || 
              !vehicleType || !vehicleMake || !vehicleModel || !vehicleYear || 
              !registrationNumber || !chassisNumber || !engineNumber || !territorialLimits) {
              console.log("One or more form fields are empty or null.");
              Swal.fire({
                  title: 'Incomplete Form',
                  text: 'Please fill in all required fields before viewing the policy.',
                  icon: 'warning',
                  confirmButtonColor: '#e21a22'
              });
              return;
          }
  
          // Create the HTML content for the modal
          var modalContent = 
              "<h4 style='background-color: #e21a22; text-align: center; color: white; border-radius: 8px; margin-bottom: 15px;'>Cover Details</h4>" +
              "<div style='margin-bottom: 20px;'>" +
              "<p><strong>Insured (ID):</strong> " + idNumber + "</p>" +
              "<p><strong>Cover Category:</strong> " + category + "</p>" +
              "<p><strong>Risk:</strong> " + policyName + "</p>" +
              "<p><strong>Premium:</strong> BWP " + premium + "</p>" +
              "<p><strong>Cover Start:</strong> " + coverStart + "</p>" +
              "<p><strong>Tenure:</strong> " + tenure + " months</p>" +
              "<p><strong>Renewal Date:</strong> " + formattedRenewalDate + "</p>" +
              "<p><strong>Expiry Date:</strong> " + formattedExpiryDate + "</p>" +
              "</div>" +
              
              "<h4 style='background-color: #e21a22; text-align: center; color: white; border-radius: 8px; margin-bottom: 15px;'>Vehicle Details</h4>" +
              "<div style='margin-bottom: 20px;'>" +
              "<p><strong>Vehicle Type:</strong> " + vehicleType + "</p>" +
              "<p><strong>Make:</strong> " + vehicleMake + "</p>" +
              "<p><strong>Model:</strong> " + vehicleModel + "</p>" +
              "<p><strong>Year:</strong> " + vehicleYear + "</p>" +
              "<p><strong>Registration Number:</strong> " + registrationNumber + "</p>" +
              "<p><strong>Chassis Number:</strong> " + chassisNumber + "</p>" +
              "<p><strong>Engine Number:</strong> " + engineNumber + "</p>" +
              "<p><strong>Territorial Limits:</strong> " + territorialLimits + "</p>" +
              "</div>";
  
          // Log a message to confirm that the modal content is created
          console.log("Modal content created:", modalContent);
  
          // Insert the content into the modal body
          $("#policyDetails").html(modalContent);
  
          // Fetch customer details based on idNumber
          $.ajax({
              url: '/admin-get-user/' + idNumber + '/',
              method: 'GET',
              success: function (data) {
                  if (data.success) {
                      var customerDetails = 
                          "<hr>" +
                          "<h4 style='background-color: #e21a22; text-align: center; color: white; border-radius: 8px '>Client Details</h4>" +
                          "<hr>" +
                          "<p>Insured (Name): " + data.user.name + "</p>" +
                          "<p>Email: " + data.user.address + "</p>" +
                          "<p>Mobile: " + data.user.mobile + "</p>" +
                          "<p>ID Number: " + data.user.id_number + "</p>" +
                          "<p>Postal Address: " + data.user.postal_address + "</p>" +
                          "<p>Physical Address: " + data.user.physical_address + "</p>" +
                          "<p>Occupation: " + data.user.occupation + "</p>" +
                          "<p>Alternate Phone: " + data.user.alternate_phone + "</p>" +
                          "<p>Gender: " + data.user.gender + "</p>" +
                          "<p>DOB: " + data.user.date_of_birth + "</p>" +
                          "<p>Marital Status: " + data.user.marital_status + "</p>";
  
                      // Append customer details to modal content
                      $("#policyDetails").append(customerDetails);
                  } else {
                      console.log("Error: " + data.error_message);
                      // Handle error scenario if needed
                  }
              },
              error: function (error) {
                  console.log("Error fetching customer details:", error);
              }
          });
  
      });
  });
    </script>
    <script>
      // Function to update renewal date based on cover start date and tenure
      function updateRenewalDate() {
        var coverStart = new Date(document.getElementById("cover_start").value);
        var tenure = parseInt(document.getElementById("id_tenure").value);
    
        if (!isNaN(tenure) && coverStart instanceof Date && !isNaN(coverStart)) {
          var coverEnd = new Date(coverStart);
          coverEnd.setMonth(coverEnd.getMonth() + tenure);
    
          // Format the date as "YYYY-MM-DD"
          var formattedRenewalDate = coverEnd.toISOString().split('T')[0];
    
          // Set the value of the renewal date input field
          document.getElementById("id_cover_end").value = formattedRenewalDate;
        }
      }
    
      // Attach the function to the change event of the cover start input field
      document.getElementById("cover_start").addEventListener("change", updateRenewalDate);
    </script>
  
  <script>
      // Function to update renewal date and expiry date based on cover start date and tenure
      function updateDates() {
        var coverStart = new Date(document.getElementById("cover_start").value);
        var tenure = parseInt(document.getElementById("id_tenure").value);
    
        if (!isNaN(tenure) && coverStart instanceof Date && !isNaN(coverStart)) {
          var coverEnd = new Date(coverStart);
          coverEnd.setMonth(coverEnd.getMonth() + tenure);
    
          // Calculate renewal date
          var formattedRenewalDate = coverEnd.toISOString().split('T')[0];
    
          // Set the value of the renewal date input field
          document.getElementById("id_cover_end").value = formattedRenewalDate;
    
          // Calculate expiry date (one day before renewal date)
          var expiryDate = new Date(coverEnd);
          expiryDate.setDate(expiryDate.getDate() - 1);
    
          // Format the date as "YYYY-MM-DD"
          var formattedExpiryDate = expiryDate.toISOString().split('T')[0];
    
          // Set the value of the expiry date input field
          document.getElementById("id_expiry_date").value = formattedExpiryDate;
        }
      }
    
      // Attach the function to the change event of the cover start input field
      document.getElementById("cover_start").addEventListener("change", updateDates);
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        $(document).ready(function () {
            // When the form is submitted
            $("form").submit(function (event) {
                // Prevent the default form submission
                event.preventDefault();
    
                // Show a confirmation dialog using SweetAlert2
                Swal.fire({
                    title: 'Create New Cover?',
                    text: "Are you sure you want to create a new cover?",
                    icon: 'question',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Yes'
                }).then((result) => {
                    // If the user confirms
                    if (result.isConfirmed) {
                        // Submit the form
                        this.submit();
                    }
                });
            });
        });
    </script>
  </body>
  
  </html>
  {% endblock content %}


