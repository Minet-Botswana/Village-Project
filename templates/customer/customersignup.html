<!DOCTYPE html>
{% load widget_tweaks %}
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <!-- Add these links to include Bootstrap and jQuery -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <style>
        form{
           margin: 50px; 
          
        }
        .title {
            text-align: center;
            color: red;
            margin-top: 75px; /* Adjust the top margin as needed */
        }
        .btn-primary{
          background-color: red !important;
          border-radius: 25px !important;
          border: #e22a21 !important;
        }
        .btn-primary:hover{
          background-color: #fff !important;
          color: #e22a21 !important;
          border: 1px solid #2f597d !important;
        }
        .form-group{
          color: #e22a21 !important;
          font-family: "Titillium Web", sans-serif !important;
        }

        .alert-messages {
    background-color: red;
    color: yellow;
    padding: 10px 20px;
    border-radius: 5px;
    margin-bottom: 20px;
  }
  .messages {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  .messages li {
    margin-bottom: 5px;
  }

    </style>
  </head>
  <body>
  
    {% include "insurance/navbar.html" %}
    <br><br><br>


    <h3 class="title" style="text-align: center;color: red;">CLIENT SIGNUP</h3>

{% if user_form_errors %}
  <div class="alert-messages">
    <ul class="messages">
      {% for field, error_list in user_form_errors.items %}
        {% for error in error_list %}
          <li>{{ error }}</li>
        {% endfor %}
      {% endfor %}
    </ul>
  </div>
{% endif %}

{% if customer_form_errors %}
<div class="alert-messages">
  <ul class="messages">
      {% for field, error_list in customer_form_errors.items %}
        {% for error in error_list %}
          <li>{{ error }}</li>
        {% endfor %}
      {% endfor %}
    </ul>
  </div>
{% endif %}



<div id="username-error-message" style="color: red; text-align: center;"></div>

    <form method="POST" autocomplete="off" enctype="multipart/form-data">
      {% csrf_token %}
      <div class="form-row">
        <div class="form-group col-md-6">
          <label for="first_name">First Name</label>
          {% render_field userForm.first_name|attr:'required:true'  class="form-control" placeholder="First Name" %}
        </div>
        <div class="form-group col-md-6">
          <label for="last_name">Last Name</label>
          {% render_field userForm.last_name|attr:'required:true'  class="form-control" placeholder="Last Name" %}
        </div>
      </div>

      <!--div class="form-row">
        <div class="form-group col-md-6">
          <label for="username">
              Username
              <i class="fas fa-info-circle" data-toggle="tooltip" title="Username is auto-generated from client's first name and last name"></i>
          </label>
          {% render_field userForm.username|attr:'required:true'  class="form-control" placeholder="Username" %}
        </div>
       <div class="form-group col-md-6">
          <label for="inputPassword4">
            Password
            <i class="fas fa-info-circle" data-toggle="tooltip" title="Enter your password"></i>
          </label>
          <div class="input-group">
            {% render_field userForm.password|attr:'required:true' class="form-control" placeholder="password" id="password-input" %}
                <button class="btn btn-outline-secondary" type="button" id="toggle-password">
                    <i class="fas fa-eye" id="eye-icon"></i>              
          </div>
          <div class="form-group col-md-6">
            <label for="confirm_password">Confirm Password</label>
            <input type="password" name="confirm_password" class="form-control" id="confirm-password-input" placeholder="Confirm Password" required>
            <div id="confirm-password-error-message" class="error-message text-danger"></div>

        </div>
        
        </div>
    </div-->
    <div class="form-row">
      <div class="form-group col-md-6">
        <label for="username">
            Username
            <i class="fas fa-info-circle" data-toggle="tooltip" title="Username is auto-generated from client's first name and last name"></i>
        </label>
        {% render_field userForm.username|attr:'required:true'  class="form-control" placeholder="Username" %}
      </div>
      <div class="form-group col-md-6">
          <label for="inputPassword4">
              Password
              <i class="fas fa-info-circle" data-toggle="tooltip" title="Enter your password"></i>
          </label>
          <div class="input-group">
              {% render_field userForm.password|attr:'required:true' class="form-control" placeholder="password" id="password-input" %}
              <button class="btn btn-outline-secondary" type="button" id="toggle-password">
                  <i class="fas fa-eye" id="eye-icon"></i>
              </button>
          </div>
      </div>
      <div class="form-group col-md-6">
          <!--label for="confirm_password">Confirm Password</label>
          <input type="password" name="confirm_password" class="form-control" id="confirm-password-input" placeholder="Confirm Password" required>
          <div id="confirm-password-error-message" class="error-message text-danger"></div-->
      </div>
      <div class="form-group col-md-6">
        <label for="confirm_password">Confirm Password</label>
        <input type="password" name="confirm_password" class="form-control" id="confirm-password-input" placeholder="Confirm Password" required>
        <div id="confirm-password-error-message" class="error-message text-danger"></div>
    </div>
  </div>
  
<br>   
<br>
      <div class="form-row">
        <div class="form-group col-md-6">
            <label for="gender">Gender</label>
            {{ customerForm.gender|attr:'required:true' }}
        </div>
        <div class="form-group col-md-6">
            <label for="date_of_birth">Date of Birth</label>
            {{ customerForm.date_of_birth|attr:'required:true' }}
        </div>
    </div>

    <div class="form-row">
        <div class="form-group col-md-6">
            <label for="marital_status">Marital Status</label>
            {{ customerForm.marital_status|attr:'required:true' }}
        </div>
        <div class="form-row">
          <div class="form-group col-md-6">
              <label for="id_type">Identification Type</label>
              {% render_field customerForm.id_type|attr:'required:true' class="form-control" %}
          </div>
          <div class="form-group col-md-6">
              <label for="id_number">ID/Passport Number</label>
              {% render_field customerForm.id_number|attr:'required:true' class="form-control" placeholder="ID/Passport Number" %}
          </div>
        </div>
    </div>

    <div class="form-row">
      <div class="form-group col-md-6">
          <label for="mobile">Mobile</label>
          {% render_field customerForm.mobile|attr:'required:true' class="form-control" placeholder="Mobile" id="id_mobile" %}
          <div id="mobile-error-message" style="color: red;"></div>
      </div>
     
      <div class="form-group col-md-6">
          <label for="address">Occupation</label>
          {% render_field customerForm.occupation|attr:'required:true'  class="form-control" placeholder="Occupation" %}
        </div>
    </div>

      <div class="form-row">
        <div class="form-group col-md-6">
          <label for="mobile">Alternate Phone
            <i class="fas fa-info-circle" data-toggle="tooltip" title="Enter N/A if not available"></i>
            <div id="mobile-error-message" style="color: red;"></div>
          </label>
          {% render_field customerForm.alternate_phone|attr:'required:false'  class="form-control" placeholder="Mobile" %}
          <div id="mobile-error-message" style="color: red;"></div>
        </div>
        <div class="form-group col-md-6">
          <label for="address">Email Address</label>
          {% render_field customerForm.address|attr:'required:true' class="form-control" placeholder="Email" %}
        </div>  
      </div>
      

      <div class="form-row">
        <div class="form-group col-md-6">
          <label for="mobile">Physical Address</label>
          {% render_field customerForm.physical_address|attr:'required:true'  class="form-control" placeholder="Physical Address" %}
        </div>
        <div class="form-group col-md-6">
          <label for="address">Postal Address</label>
          {% render_field customerForm.postal_address|attr:'required:true'  class="form-control" placeholder="Postal Address" %}
        </div>
      </div>

      <div class="form-row">
        <!--div class="form-group col-md-6">
          <label for="mobile">Physical Address</label>
          {% render_field customerForm.mobile|attr:'required:true'  class="form-control" placeholder="Mobile" %}
        </div>
        <div class="form-group col-md-6">
          <label for="address">Occupation</label>
          {% render_field customerForm.occupation|attr:'required:true'  class="form-control" placeholder="Occupation" %}
        </div-->
      </div>
      <div class="form-row">
        <!--div class="form-group col-md-12">
          <label for="profile_pic">Profile Picture
            <i class="fas fa-info-circle" data-toggle="tooltip" title="Please upload an image displaying the upper body, covering the area from the chest to the head. This helps us create a professional and identifiable profile for you."></i>
          </label>
          {% render_field customerForm.profile_pic|attr:'required:true' class="form-control" placeholder="" %}
        </div-->
        <!--div class="form-group col-md-12">
          <label for="profile_pic">Profile Picture
              <i class="fas fa-info-circle" data-toggle="tooltip" title="Please upload an image displaying the upper body, covering the area from the chest to the head. This helps us create a professional and identifiable profile for you."></i>
          </label>
          {% render_field customerForm.profile_pic|attr:'required:true' class="form-control" placeholder="" %}
      </div-->     
      </div>
      <button type="submit" class="btn btn-primary">Sign Up</button>
    </form>

    <!-- JAVASCRIPT SCRIPTS FOR MORE FUNCTIONALITIES -->

    <script>
      //Function to display the tooltip information 'i' icon
      $(document).ready(function(){
        $('[data-toggle="tooltip"]').tooltip(); 
      });
    </script>
    <script>
      $(document).ready(function () {
        // Function to update the username field
        function updateUsername() {
          var firstName = $('#id_first_name').val().toLowerCase();
          var lastName = $('#id_last_name').val().toLowerCase();
          var generatedUsername = firstName.charAt(0) + lastName;
          $('#id_username').val(generatedUsername);
        }
    
        // Listen for changes in the first_name and last_name fields
        $('#id_first_name, #id_last_name').on('input', function () {
          updateUsername();
        });
        // Initial username update
        updateUsername();
      });

    </script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        var mobileInput = document.getElementById("id_mobile");
        var alternatePhoneInput = document.getElementById("id_alternate_phone");

  
          mobileInput.addEventListener("input", function () {
              var mobileValue = mobileInput.value.trim();
              var errorMessage = document.getElementById("mobile-error-message");
  
              // Validate if the mobile number is exactly 8 digits and does not include the country code +267
              if (/^\d{8}$/.test(mobileValue) && !mobileValue.startsWith("+267")) {
                  errorMessage.textContent = "";  // Clear any previous error message
              } else {
                  errorMessage.textContent = "Please enter a valid 8-digit mobile number without the country code +267.";
              }
          });
      });
  </script>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
        const passwordInput = document.getElementById("password-input");
        const togglePasswordButton = document.getElementById("toggle-password");
        const eyeIcon = document.getElementById("eye-icon");

        togglePasswordButton.addEventListener("click", function() {
            if (passwordInput.type === "password") {
                passwordInput.type = "text";
                eyeIcon.classList.remove("fa-eye");
                eyeIcon.classList.add("fa-eye-slash");
            } else {
                passwordInput.type = "password";
                eyeIcon.classList.remove("fa-eye-slash");
                eyeIcon.classList.add("fa-eye");
            }
        });
    });
</script>
<script>
  $(document).ready(function() {
    // Function to display error message for username
    function displayUsernameErrorMessage() {
      $('#username-error-message').text("A user with that username already exists.");
    }

    // Check if the user form has errors related to the username field
    var userFormErrors = '{{ user_form_errors }}';
    if (userFormErrors.includes('username')) {
      displayUsernameErrorMessage();
    }
  });
</script>

<script>
  $(document).ready(function () {
      // Function to validate password confirmation
      function validatePasswordConfirmation() {
          var password = $('#password-input').val();
          var confirmPassword = $('#confirm-password-input').val();
          var errorMessage = $('#confirm-password-error-message');

          if (password === confirmPassword) {
              errorMessage.text("Passwords match!");  // Clear any previous error message
              return true;
          } else {
              errorMessage.text("Passwords do not match!");
              return false;
          }
      }

      // Listen for changes in the password and password confirmation fields
      $('#password-input, #confirm-password-input').on('input', function () {
          validatePasswordConfirmation();
      });

      // Validate the password confirmation before submitting the form
      $('form').submit(function (event) {
          if (!validatePasswordConfirmation()) {
              event.preventDefault(); // Prevent form submission if passwords do not match
          }
      });
  });
</script>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    // Select the form element
    const form = document.querySelector("form");

    // Add event listener for form submission
    form.addEventListener("submit", function(event) {
      // Prevent the form from submitting immediately
      event.preventDefault();

      // Log all form data
      const formData = new FormData(form);
      for (const pair of formData.entries()) {
        console.log(pair[0] + ': ' + pair[1]);
      }

      // Use AJAX to submit the form data
      const xhr = new XMLHttpRequest();
      xhr.open("POST", form.action);
      xhr.setRequestHeader("X-Requested-With", "XMLHttpRequest");
      xhr.onreadystatechange = function() {
        if (xhr.readyState === XMLHttpRequest.DONE) {
          if (xhr.status === 200) {
            // Form submitted successfully
            console.log(xhr.responseText);
          } else {
            // Error handling
            console.error("Error:", xhr.statusText);
          }
        }
      };
      xhr.send(formData);
    });
  });
</script>




    {% include "insurance/footer.html" %}
  </body>
</html>
